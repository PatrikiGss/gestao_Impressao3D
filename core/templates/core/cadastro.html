<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Cadastro de Modelo 3D</title>
</head>
<body>
    <h1>Cadastro - Informações</h1>

    <!-- mostra erros não campo (form.non_field_errors) e erros do form -->
    {% if form.non_field_errors %}
    <div style="color: red;">
        {{ form.non_field_errors }}
    </div>
    {% endif %}

    {% if form.errors %}
    <div style="color: red;">
        <ul>
        {% for field, errors in form.errors.items %}
            <li><strong>{{ field }}:</strong>
                <ul>
                {% for err in errors %}
                    <li>{{ err }}</li>
                {% endfor %}
                </ul>
            </li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}

    <form method="post" enctype="multipart/form-data" id="form-cadastro">
        {% csrf_token %}

        <label for="{{ form.nome.id_for_label }}">Nome:</label>
        {{ form.nome }} <br>

        <label for="{{ form.curso.id_for_label }}">Curso:</label>
        {{ form.curso }} <br>

        <label for="{{ form.quant_de_pecas.id_for_label }}">Quantidade de peças:</label>
        {{ form.quant_de_pecas }} <br>

        <label for="{{ form.cor.id_for_label }}">Cor:</label>
        {{ form.cor }} <br>

        <label for="{{ form.telefone.id_for_label }}">Telefone:</label>
        {{ form.telefone }} <br>

        <label for="{{ form.arq_upload.id_for_label }}">Arquivo (.stl, .obj, .3mf, .gcode):</label>
        {{ form.arq_upload }} <br>

        <label for="{{ form.arq_link.id_for_label }}">Link do arquivo (opcional):</label>
        {{ form.arq_link }} <br>

        <p>Possui conhecimento técnico?</p>
        <label><input type="radio" name="conhecimento" value="nao" checked onclick="toggleCampos(false)"> Não</label>
        <label><input type="radio" name="conhecimento" value="sim" onclick="toggleCampos(true)"> Sim</label>

        <div id="campos-tecnicos" style="display:none; margin-top:10px;">
            <h3>Campos técnicos (opcionais)</h3>

            <label for="{{ form.tipo_preenchimento.id_for_label }}">Tipo de preenchimento:</label>
            {{ form.tipo_preenchimento }} <br>

            <label for="{{ form.porcentagem_preenchimento.id_for_label }}">Porcentagem de preenchimento:</label>
            {{ form.porcentagem_preenchimento }} <br>

            <label for="{{ form.resolucao.id_for_label }}">Resolução:</label>
            {{ form.resolucao }} <br>

            <label for="{{ form.qual_impressora.id_for_label }}">Qual impressora:</label>
            {{ form.qual_impressora }} <br>

            <label for="{{ form.tipo_filamento.id_for_label }}">Tipo de filamento:</label>
            {{ form.tipo_filamento }} <br>
        </div>

        <br>
        <button type="submit">Enviar</button>
    </form>

    <p><a href="{% url 'core:lista_models' %}">Ver lista de cadastros</a></p>

<script>
/* mostra/esconde campos técnicos */
function toggleCampos(mostrar) {
    document.getElementById('campos-tecnicos').style.display = mostrar ? 'block' : 'none';
}

/* validação simples cliente: verifica extensão do arquivo antes de submeter,
   evita envio de arquivos óbvios inválidos (comportamento complementar à validação do server) */
document.getElementById('form-cadastro').addEventListener('submit', function(e){
    const fileInput = document.querySelector('input[type="file"][name="arq_upload"]');
    if (fileInput && fileInput.files.length > 0) {
        const allowed = ['.stl', '.obj', '.3mf', '.gcode'];
        const name = fileInput.files[0].name.toLowerCase();
        const ext = name.substring(name.lastIndexOf('.'));
        if (!allowed.includes(ext)) {
            e.preventDefault();
            alert('Formato inválido! Envie um arquivo 3D (.stl, .obj, .3mf ou .gcode).');
            return false;
        }
    }
    // se não tiver arquivo, o server validará se existe link
});
</script>
</body>
</html>
